#!/usr/bin/env bash
# @description install dotfiles
# @dependency fish
# @dependency git
# @import dotfiles/runcoms
# @import manage/manage
# @import console/warn

main() {
  strict true
  verbose true

  # _ manage trust-escapace

  if [ -d "$HOME/.dotfiles" ] || [ -L "$HOME/.dotfiles" ]; then
    cd "$HOME/.dotfiles" || exit 1

    git submodule update --init --recursive

    _ manage install-svu
    _ manage install-fd
    _ manage install-delta
    _ manage install-zoxide

    if [[ ! -L "${HOME}/.config/fish" ]]; then
      _ warn "Deleting ${HOME}/.config/fish"

      rm -rf "${HOME}/.config/fish"
    fi

    _ runcoms install "${HOME}"/.dotfiles/runcoms

    (
      cd "${HOME}/.dotfiles/vendor/fzf" || exit 1
      "${HOME}/.dotfiles/vendor/fzf/install" --bin

      if [[ ! -f "${HOME}/.dotfiles/bin/fzf" ]]; then
        ln -s "${HOME}/.dotfiles/vendor/fzf/bin/fzf" \
          "${HOME}/.dotfiles/bin/fzf"
      fi
    )
  fi
}
